# 用户管理系统文档

## 系统管理员账户

### 默认管理员

系统在初始化时会自动创建一个系统管理员账户：

| 字段       | 值                       | 说明                   |
| ---------- | ------------------------ | ---------------------- |
| **姓名**   | 陈辉                     | 系统管理员真实姓名     |
| **用户名** | samchen                  | 登录用户名             |
| **密码**   | 123456                   | 默认密码（已加密存储） |
| **邮箱**   | samchen@sinabuddy.com    | 联系邮箱               |
| **手机**   | 13837147910              | 联系电话               |
| **状态**   | 禁用 (disableFlag: true) | 账户状态               |
| **角色**   | 全部权限 [1,2,3,4,5,6]   | 拥有所有角色权限       |

### 角色权限说明

该管理员拥有系统中所有角色的权限：

1. **业务员 (SALES)** - ID: 1
2. **单证 (DOCUMENT)** - ID: 2
3. **海运 (SHIPPING)** - ID: 3
4. **货源 (SUPPLY)** - ID: 4
5. **经理 (MANAGER)** - ID: 5
6. **管理员 (ADMIN)** - ID: 6

## 初始化命令

### 数据库初始化

```bash
# 初始化所有种子数据（角色 + 用户）
npm run seed

# 重置所有数据并重新初始化
npm run seed:reset

# 查看当前数据库状态
npm run seed:status

# 仅初始化角色数据
npm run seed:roles
```

### 初始化流程

1. **角色初始化**：系统会先检查并初始化6个系统角色
2. **用户初始化**：然后创建系统管理员账户
3. **密码加密**：用户密码会通过 bcrypt 自动加密（cost: 12）
4. **防重复**：如果数据已存在，会自动跳过初始化

## 密码安全

- 所有用户密码都通过 bcrypt 进行哈希加密
- 加密强度为 cost 12
- 密码在保存前会自动通过 pre-save 中间件加密
- 提供 comparePassword 方法用于密码验证

## 数据模型

### 用户实体

```typescript
{
  name: string;           // 姓名
  username: string;       // 用户名（唯一，最少6位）
  password: string;       // 密码（加密存储，最少6位）
  email: string;         // 邮箱（唯一）
  phone: string;         // 手机号（中国手机号格式）
  disableFlag: boolean;  // 是否禁用
  roles: UserRole[];     // 角色数组
  createdAt?: Date;      // 创建时间
  updatedAt?: Date;      // 更新时间
}
```

## 注意事项

1. **安全提醒**：默认密码为简单密码，生产环境请及时修改
2. **账户状态**：默认账户为禁用状态，需要手动启用
3. **权限管理**：该账户拥有系统最高权限，请谨慎使用
4. **数据重置**：重置命令会清空所有用户数据，请谨慎操作

## 相关文件

- 用户种子数据：`/src/database/seeds/users.seed.ts`
- 用户实体模型：`/src/users/entities/user.entity.ts`
- 数据库种子服务：`/src/database/database-seed.service.ts`
- 初始化脚本：`/src/scripts/seed.ts`

## 更新日志

- **2024-01-01**: 创建系统管理员账户陈辉
- **2024-01-01**: 实现用户密码自动加密功能
- **2024-01-01**: 添加用户数据初始化和管理功能
